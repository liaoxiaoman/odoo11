<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record id="dtask_attachment_form" model="ir.ui.view">
            <field name="name">文档参考</field>
            <field name="model">dtask.attachment</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <sheet>
                            <group>
                                <field name="filename"/>
                                <field name="project_id"/>
                                <field name="preview" widget="image"/>
                            </group>
                            <group>
                                <field name="description"/>
                                <field name="task_id"/>
                                <field name="data"/>
                            </group>
                        </sheet>
                    </group>
                </form>
            </field>
        </record>

        <record id="dtask_task_tree" model="ir.ui.view">
            <field name="name">任务</field>
            <field name="model">dtask.task</field>
            <field name="arch" type="xml">
                <tree default_order="id desc" decoration-danger="recent_progress != '3' and deadline and (deadline&lt;current_date)">
                    <field name="id"/>
                    <field name="task_description"/>
                    <field name="project_id"/>
                    <field name="performer"/>
                    <field name="reviewer"/>
                    <field name="deadline"/>
                    <field name="version"/>
                    <field name="recent_progress"/>
                </tree>
            </field>
        </record>

        <record id="dtask_version_mark_form" model="ir.ui.view">
            <field name="name">版本标记</field>
            <field name="model">version_mark</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <sheet>
                            <group>
                                <field name="id" invisible="1"/>
                                <field name="version"/>
                                <field name="upgrade_date"/>
                            </group>
                            <footer>
                                <button name="action_affirm" type="object"
                                        string="确认" class="oe_highlight"/>
                                <button string="取消" class="oe_link" special="cancel"/>
                            </footer>
                        </sheet>
                    </group>
                </form>
            </field>
        </record>

        <record id="dtask_description_form" model="ir.ui.view">
            <field name="name">任务描述</field>
            <field name="model">description</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <sheet>
                            <group>
                                <field name="id" invisible="1"/>
                                <pre>
                                    <field name="description" readonly="True"/>
                                </pre>
                            </group>
                            <footer>
                                <button string="关闭" class="oe_link" special="cancel"/>
                            </footer>
                        </sheet>
                    </group>
                </form>
            </field>
        </record>

        <record id="dtask_task_form" model="ir.ui.view">
            <field name="name">任务</field>
            <field name="model">dtask.task</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_done" string="完成" type="object" class="oe_highlight"
                                attrs="{'invisible':[('recent_progress','!=','1')]}"/>
                        <button name="action_commit" string="提交" type="object" class="oe_highlight"
                                attrs="{'invisible':[('recent_progress','!=','1.5')]}"/>
                        <button name="action_pass" string="验证通过" type="object" class="oe_highlight"
                                attrs="{'invisible':[('recent_progress','!=','2')]}"/>
                        <button name="action_reject" string="验证未通过" type="object" class="cancel_button"
                                attrs="{'invisible':[('recent_progress','!=','2')]}"/>
                        <button name="action_suspend" string="挂起" type="object" class="oe_highlight"/>
                        <button name="action_recover" string="恢复" type="object" class="cancel_button"
                                attrs="{'invisible':[('recent_progress','!=','3'),('recent_progress','!=','4')]}"/>
                        <field name="recent_progress" widget="statusbar" statusbar_visible="1,1.5,2,3,4"/>
                    </header>
                    <sheet>
                        <group>
                            <field name="id"/>
                            <field name="project_id"/>
                            <field name="task_description" required="1"/>
                            <field name="function_menu"/>
                            <field name="performer" required="1" options="{'no_create':True}"/>
                            <field name="reviewer" required="1" options="{'no_create':True}"/>
                            <field name="deadline" required="1"/>
                            <field name="commit_time" readonly="1"/>
                            <field name="close_time" readonly="1"/>
                            <field name="priority"/>
                            <field name="task_type"/>
                            <field name="create_user" required="1" options="{'no_create':True}"/>
                            <field name="create_date" readonly="1"/>
                            <field name="version"/>
                            <field name="upgrade_date"/>
                            <field name="remark"/>
                            <field name="task_attachment_ids">
                                <tree editable="bottom">
                                    <field name="filename" invisible="0"/>
                                    <field name="description"/>
                                    <field name="data" filename="filename"/>
                                </tree>
                            </field>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="dtask_task_search" model="ir.ui.view">
            <field name="name">dtask.task.search</field>
            <field name="model">dtask.task</field>
            <field name="arch" type="xml">
                <search>
                    <field name="task_description"/>
                    <field name="function_menu"/>
                    <field name="project_id"/>
                    <field name='id'/>
                    <field name="remark"/>
                    <filter string="我的待办" name="my_task"
                            domain="['|','&amp;',('performer','=',uid),('recent_progress','in',['1','1.5']),'&amp;',('reviewer','=',uid),('recent_progress','=','2')]"/>
                    <filter string="我创建的" name="my_created"
                            domain="[('create_user','=',uid),('recent_progress','!=','3')]"/>
                    <filter string="异常任务" name="my_created"
                            domain="[('recent_progress','not in',('3','4')),('deadline','&lt;',context_today().strftime('%%Y-%%m-%%d'))]"/>
                    <group>
                        <filter string="时间" name="deadline" context="{'group_by':'deadline:day'}"/>
                        <filter string="项目" name="project" context="{'group_by':'project_id'}"/>
                        <filter string="优先级" name="priority" context="{'group_by':'priority'}"/>
                        <filter string="当前进度" name="current_progress" context="{'group_by':'recent_progress'}"/>
                        <filter string="版本号" name="version" context="{'group_by':'version'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="dtask_task_action" model="ir.actions.act_window">
            <field name="name">任务</field>
            <field name="res_model">dtask.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">
                {'default_recent_progress':'1','search_default_my_task':1}
            </field>
            <field name="search_view_id" ref="dtask_task_search"/>
        </record>

        <menuitem id="dtask" name="任务管理"/>
        <menuitem id="dtask_task_menu" name="任务" parent="dtask"/>
        <menuitem id="dtask_task" name="任务" action="dtask_task_action" parent="dtask_task_menu"/>
    </data>
</odoo>